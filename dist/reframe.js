!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("Rx"),require("Immutable"),require("React")):"function"==typeof define&&define.amd?define(["Rx","Immutable","React"],t):"object"==typeof exports?exports.reframe=t(require("Rx"),require("Immutable"),require("React")):e.reframe=t(e.Rx,e.Immutable,e.React)}(this,function(e,t,r){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="/js/",t(0)}([function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}var i=r(7),o=n(i),u=r(2),a=n(u),s=r(4),c=n(s),f=r(6),l=n(f),d=r(8),p=n(d);e.exports.registerHandler=o.registerHandler,e.exports.dispatch=o.dispatch,e.exports.dispatchSync=o.dispatchSync,e.exports.registerSub=a.registerSub,e.exports.subscribe=a.subscribe,e.exports.indexPath=a.indexPath,e.exports.db$=c.db$,e.exports.viewP=p.viewP,e.exports.viewV=p.viewV,e.exports.viewSP=p.viewSP,e.exports.viewSV=p.viewSV,e.exports.view=p.viewSV,e.exports.deref=p.deref,e.exports.atom=l.atom,e.exports.swap=l.swap,e.exports.reset=l.reset,e.exports.pause$=p.pause$,e.exports.compMiddleware=o.compMiddleware},function(t,r){t.exports=e},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function i(e,t){m.register(e,t)}function o(e){var t=m.lookup(e[0]);return t(v,e)}function u(e,t){return w.sub(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.render$=t.sync$=t.animationFrame$=void 0;var a=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(s){i=!0,o=s}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.registerSub=i,t.subscribe=o,t.indexPath=u;var s=r(1),c=n(s),f=r(5),l=r(10),d=t.animationFrame$=new c.BehaviorSubject,p=new c.Subject,h=t.sync$=new c.Subject,v=new c.BehaviorSubject,b=t.render$=new c.Subject,y=!1;d.filter(Boolean).doOnNext(function(e){y||(requestAnimationFrame(function(){p.onNext(d.getValue()),y=!1}),y=!0)}).subscribe(),c.Observable.merge(p,h).scan(function(e,t){var r=a(e,2),n=r[0],i=r[1],o=a(t,2),u=o[0],s=o[1];return u>n?[u,s]:[n,i]},[-1,null]).map(function(e){var t=a(e,2),r=(t[0],t[1]);return r}).distinctUntilChanged(function(e){return e},function(e,t){return e===t}).doOnNext(function(e){v.onNext(e),b.onNext(!0)}).subscribe();var m=new f.Dispatcher,w=new l.Index(function(){return v})},function(e,r){e.exports=t},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.db$=void 0;var i=r(1),o=n(i),u=r(3),a=n(u);t.db$=new o.BehaviorSubject(a.Map())},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Dispatcher=function(){function e(){r(this,e),this.map={}}return n(e,[{key:"register",value:function(e,t){this.map[e]=t}},{key:"lookup",value:function(e){return this.map[e]}}]),e}()},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function i(e){return new s.BehaviorSubject(e)}function o(e,t){e.onNext(t(e.getValue()))}function u(e,t){e.onNext(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.atom=i,t.swap=o,t.reset=u;var a=r(1),s=n(a)},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function i(e){return function(t){var r=e.reverse().filter(function(e){return e}).reduce(function(e,t){return t(e)},t);return r}}function o(){var e=void 0,t=void 0,r=void 0;switch(arguments.length){case 2:e=arguments[0],t=function(e){return e},r=arguments[1];break;case 3:e=arguments[0],t=Array.isArray(arguments[1])?i(arguments[1]):arguments[1],r=arguments[2];break;default:throw new Error("Expected 2 or 3 arguments, got "+arguments.length)}b.register(e,t(r))}function u(e){y.onNext([!1,e])}function a(e){y.onNext([!0,e])}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(s){i=!0,o=s}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.compMiddleware=i,t.registerHandler=o,t.dispatch=u,t.dispatchSync=a;var c=r(4),f=r(1),l=n(f),d=r(2),p=r(5),h=r(3),v=n(h),b=new p.Dispatcher,y=new l.Subject;y.scan(function(e,t){var r=s(e,2),n=r[0],i=r[1],o=s(t,2),u=o[0],a=o[1],f=b.lookup(a[0]),l=f(i,a);if(l!==i){c.db$.onNext(l);var p=n+1;return u?d.sync$.onNext([p,l]):d.animationFrame$.onNext([p,l]),[p,l]}return[n,i]},[0,v.Map()]).subscribe()},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){var r=t||function(e){return e},n=new _.BehaviorSubject;return e.map(r).subscribe(n).dispose(),n.getValue()}function u(e){return e.map(function(e){return e.shouldUpdate()}).reduce(function(e,t){return e||t},!1)}function a(e){U.toUpdate.push([e.state.renderOrder,function(){u(e.state.derefed)&&e.forceUpdate()}])}function s(){U.toUpdate.sort(function(e,t){var r=w(e,1),n=r[0],i=w(t,1),o=i[0];return n-o}),U.toUpdate.forEach(function(e){var t=w(e,2),r=(t[0],t[1]);return r()}),U.toUpdate=[]}function c(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function f(){return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}function l(e,t){var r=void 0;switch(t.length){case 2:"undefined"==typeof t[1].prototype?(t[1].mixins=e,r=t[1]):r={mixins:e,render:t[1]};break;case 3:"undefined"==typeof t[2].prototype?(t[2].mixins=e.concat(t[1]),r=t[2]):r={mixins:e.concat(t[1]),render:t[2]};break;default:throw new Error("Expected 2 or 3 arguments, got "+t.length)}return r.displayName=t[0],r}function d(e,t){var r=l(e,t),n=r.render;r.render=function(){return n.call(this,this.props)};var i=j.createClass(r);return j.createFactory(i)}function p(e,t){var r=l(e,t),n=r.render;r.render=function(){return n.apply(this,this.props.argv)};var i=j.createClass(r),o=j.createFactory(i);return function(){return o({argv:Array.prototype.slice.call(arguments)})}}function h(){return d([I],arguments)}function v(){return p([I],arguments)}function b(){return d([k],arguments)}function y(){return p([k],arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionMixin=t.StatelessMixin=t.pause$=void 0;var m=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),w=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(s){i=!0,o=s}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.deref=o,t.render=s,t.viewP=h,t.viewV=v,t.viewSP=b,t.viewSV=y;var x=r(2),g=n(x),S=r(11),j=n(S),O=r(1),_=n(O),M=r(9),P=t.pause$=new _.BehaviorSubject(!0),U={renderOrder:0,toUpdate:[]};g.render$.pausable(P).subscribe(s);var I=t.StatelessMixin={shouldComponentUpdate:function(e,t){return(0,M.shouldUpdate)(this.props,e,["argv"])||(0,M.shouldUpdate)(this.state,t)||(0,M.shouldUpdate)(this.props.argv,e.argv)},getDisplayName:function(){return this.constructor.displayName}},C=function(){function e(t,r,n,o){i(this,e);var u=n||function(e){return e},s=new _.ReplaySubject(1),c=new _.BehaviorSubject,f=new _.CompositeDisposable(r.distinctUntilChanged(function(e){return e},function(e,t){return e===t}).map(u).subscribe(s),s.subscribe(c),s.skip(1).subscribe(function(){a(t)}));this.disposable=f,this.subject=c,this.renderCycle=null}return m(e,[{key:"getValue",value:function(e){return this.renderCycle=e,this.lastValue=this.subject.getValue(),this.lastValue}},{key:"dispose",value:function(){this.disposable.dispose()}},{key:"shouldDispose",value:function(e){return e>this.renderCycle}},{key:"shouldUpdate",value:function(){return this.lastValue!==this.subject.getValue()}}]),e}(),k=t.SubscriptionMixin={derefSub:function(e,t){return this.deref(g.subscribe(e),t,Immutable.List(e))},getDisplayName:function(){return this.constructor.displayName},getInitialState:function(){return{derefed:Immutable.Map(),renderOrder:U.renderOrder++,renderCycle:0}},shouldComponentUpdate:function(e,t){var r=(0,M.shouldUpdate)(this.props,e,["argv"])||(0,M.shouldUpdate)(this.props.argv,e.argv),n=(0,M.shouldUpdate)(this.state,t,["derefed","renderOrder","renderCycle"]);return r||n},deref:function(e,t,r){var n=r||f();if(this.state.derefed.get(n))return this.state.derefed.get(n).getValue(this.state.renderCycle);var i=new C(this,e,t);return this.state.derefed=this.state.derefed.set(n,i),i.getValue(this.state.renderCycle)},unsubscribe:function(){this.state.derefed.forEach(function(e){e.dispose()}),this.state.derefed=Immutable.Map()},componentWillUpdate:function(){this.state.renderCycle++},componentDidUpdate:function(){var e=this;this.state.derefed.filter(function(t){return t.shouldDispose(e.state.renderCycle)}).forEach(function(e){return e.dispose()}),this.state.derefed=this.state.derefed.filter(function(t){return!t.shouldDispose(e.state.renderCycle)})},componentWillUnmount:function(){this.unsubscribe()}}},function(e,t){"use strict";function r(e,t,r){var o=void 0;return t===e||t.length!==e.length?!1:(o=r&&r.length>0?Object.keys(e).filter(function(e){return-1===r.indexOf(e)}).map(function(r){return[e[r],t[r]]}):Object.keys(e).map(function(r){return[e[r],t[r]]}),o.length?!o.every(function(e){var t=u(e,2),r=t[0],o=t[1];return i(r)&&i(o)||n(r)&&n(o)?r===o:!1}):!1)}function n(e){return Immutable.Iterable.isIterable(e)}function i(e){var t="undefined"==typeof e?"undefined":o(e);return"number"===t||"boolean"===t||"string"===t||null===e||void 0===e}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},u=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(s){i=!0,o=s}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.shouldUpdate=r},function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Index=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(3),a=n(u),s=r(1),c=n(s),f={};t.Index=function(){function e(t){i(this,e),this.listeners=a.Map(),this.rx=t}return o(e,[{key:"sub",value:function(e,t){for(var r=this,n=this,i=[],o=0;o<e.length;o++)i.push(Array.prototype.slice.call(e.slice(0,o+1)));return this.listeners=i.reduce(function(e,t){var i=t.slice(0,t.length-1),o=0===i.length?r.rx():e.getIn(i.concat(f)),u=t[t.length-1];return e.updateIn(t.concat(f),function(e){if(e)return e;var r=new c.ReplaySubject(1),i=o.map(function(e){return e&&e.get?e.get(u):void 0}).distinctUntilChanged(function(e){return e},function(e,t){return e===t}).subscribe(r),a=r.subscribe;return r.subscribe=function(){var e=a.apply(this,arguments);return c.Disposable.create(function(){e.dispose(),r.hasObservers()||(i.dispose(),n.listeners=n.listeners.removeIn(t))})},r})},this.listeners),this.listeners.getIn(e.concat([f])).map(function(e){return"undefined"!=typeof e?e:t})}}]),e}()},function(e,t){e.exports=r}])});
//# sourceMappingURL=reframe.js.map